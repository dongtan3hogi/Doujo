<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.scit.doujo.dao.friendDao">

   <insert id="insert" parameterType="string">
		INSERT INTO friend(
			userid,
			friendid,
			type
		) VALUES
			(#{userid},
			 #{id},
			 2
			)
	</insert> 
	<insert id="beInserted" parameterType="string">
		INSERT INTO friend(
			userid,
			friendid,
			type
		) VALUES
			(
			 #{1},
			 #{0},
			 3
			)
	</insert> 

	<update id="updateMember" parameterType="member" >
		update member set job=#{job}, hobby = #{hobby} where id =#{id} 
	</update>
	
	<select id="getRecommendFriendsCount" parameterType="map" resultType="int">
		select 
			count(*)
		from 
			member 
		<if test="searchItem == 'id'">
		where 
			id like '%' || #{searchWord} || '%'
		</if>
		<if test="searchItem == 'hobby'">
		where 
			hobby like '%' || #{searchWord} || '%'
		</if>
		<if test="searchItem == 'job'">
		where 
			job like '%' || #{searchWord} || '%'
		</if>
	</select>
	
	<select id="getMyFriendsCount" parameterType="map" resultType="int">
		select 
			count(*)
		from 
			friend 
		<if test="searchItem2 == 'friendid'">
		where 
			friendid like '%' || #{searchWord2} || '%'
		</if>
	</select>
	
	<!-- 현재 페이지 목록 (검색 필터링 후) -->
	<select id="getRecommendFriends" parameterType="map" resultType="member">
		select 
			*
		from 
			member 
		<if test="searchItem == 'id'">
		where 
			id like '%' || #{searchWord} || '%' and id not in #{meme} 
		</if>
		
		<if test="searchItem == 'job'">
		where 
			job like '%' || #{searchWord} || '%' and id not in #{meme} 
		</if>
		<if test="searchItem == 'hobby'">
		where 
			hobby like '%' || #{searchWord} || '%' and id not in #{meme} 
		</if>
	</select>
	
	<select id="getMyFriends" parameterType="map" resultType="friend">
		select 
			a.userid,a.friendid,b.nickname,b.name,b.gender,b.age,b.job,b.hobby,a.type 
		from 
			friend a,member b
		where a.friendid = b.id and a.userid =#{id} 
		<if test="searchItem == 'friendid'">
		and a.friendid like '%' || #{searchWord} || '%'
		</if>
	</select>
   
    <delete id="deletemember" parameterType="member">
		delete
		from
			member
		where
			id = #{id}
	</delete>
	
	 <delete id="delMember" parameterType="String">
		delete
		from
			member
		where
			id = #{value}
	</delete>
	<update id="acceptFriend" parameterType="String">
	update friend set type=1 where userid= #{0} and friendid= #{1}
	</update>

	<select id="checkFriend" parameterType="String" resultType="friend">
	select * from friend where userid= #{0} and friendid= #{1}
	</select>
	
	<!-- 친구목록 불러오기 -->
	<select id="selectFriendLsit" parameterType="String" resultType="friend">
		select * from friend where userid=#{userid}
	</select>
	
		
</mapper>